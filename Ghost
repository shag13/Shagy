from dotenv import load_dotenv
import telebot
import random
import time
import threading
from datetime import datetime, timedelta
import pytz
import schedule
from collections import deque
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
import sqlite3
import os

load_dotenv()
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = telebot.TeleBot(os.getenv('TOKEN_GHOST'))
ADMIN_IDS = [int(admin_id) for admin_id in os.getenv('ADMIN_IDS').split(',')]
CHAT_ID = int(os.getenv('CHAT_ID'))

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite
conn = sqlite3.connect('bot_database.db', check_same_thread=False)
cursor = conn.cursor()

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—ã–±—Ä–∞–≤—à–∏—Ö "–ö—Ä–∞—Å–Ω—É—é —Ç–∞–±–ª–µ—Ç–∫—É"
cursor.execute('''
CREATE TABLE IF NOT EXISTS red_pill_users (
    user_id INTEGER PRIMARY KEY
)
''')
conn.commit()

# –°–ø–∏—Å–∫–∏ —Ñ—Ä–∞–∑ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
ghost_responses = ["–ö—Ç–æ –ø–æ—Å–º–µ–ª –ø–æ—Ç—Ä–µ–≤–æ–∂–∏—Ç—å –º–æ—é –¥—É—à—É?", "–ö—Ç–æ –æ—Å–º–µ–ª–∏–ª—Å—è –≤—ã–∑–≤–∞—Ç—å –º–µ–Ω—è?"]
spirit_response = "–ï—â–µ –Ω–µ—Ç"
bones_response = "–ß—å–∏ –∫–æ—Å—Ç–∏?"
fear_response = "–°–µ–π—á–∞—Å –≤—ã –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ –Ω–∞—Å—Ç–æ—è—â–∏–π —Å—Ç—Ä–∞—Ö"
scary_phrases = ["–¢—å–º–∞ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è...", "–í—ã —Å–ª—ã—à–∏—Ç–µ —ç—Ç–∏ —à–∞–≥–∏?", "–ö—Ç–æ-—Ç–æ —Å—Ç–æ–∏—Ç –∑–∞ –≤–∞–º–∏...", "–¢–∏—à–∏–Ω–∞... —Å–ª–∏—à–∫–æ–º —Ç–∏—Ö–∞—è..."]
empty_chat_phrases = ["–¢–∏—à–∏–Ω–∞... —Å–ª–∏—à–∫–æ–º –ø—É–≥–∞—é—â–∞—è...", "–ù–∏–∫—Ç–æ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç... –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ...", "–ü—É—Å—Ç–æ—Ç–∞... –æ–Ω–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å..."]
first_message_phrases = ["–ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ –∫—Ç–æ-—Ç–æ –ø–æ—è–≤–∏–ª—Å—è!", "–ö—Ç–æ –æ—Å–º–µ–ª–∏–ª—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è?", "–û, –Ω–æ–≤—ã–π –∂–µ—Ä—Ç–≤–æ–ø—Ä–∏–Ω–æ—à–µ–Ω–∏–µ!"]
curses = ["–ü—Ä–æ–∫–ª—è—Ç–∏–µ –Ω–∞ –≤–∞—à –¥–æ–º!", "–í–∞—à–∞ –¥—É—à–∞ –±—É–¥–µ—Ç –≥–æ—Ä–µ—Ç—å!", "–í—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–π–¥–µ—Ç–µ –ø–æ–∫–æ—è!"]
warnings = ["–û—Å—Ç–æ—Ä–æ–∂–Ω–æ, —Ç—å–º–∞ —Ä—è–¥–æ–º!", "–ù–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ—Å—å...", "–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Ö–æ–ª–æ–¥ –∑–∞ —Å–ø–∏–Ω–æ–π?"]
morning_wishes = [
    "–ü—É—Å—Ç—å –≤–∞—à –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —É–∂–∞—Å–æ–º!",
    "–°—Ç—Ä–∞—Ö –±—É–¥–µ—Ç –≤–∞—à–∏–º —Å–ø—É—Ç–Ω–∏–∫–æ–º —Å–µ–≥–æ–¥–Ω—è!",
    "–ü—É—Å—Ç—å —Ç—å–º–∞ –æ–±–Ω–∏–º–µ—Ç –≤–∞—Å —Å–µ–≥–æ–¥–Ω—è!",
    "–°–µ–≥–æ–¥–Ω—è –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ—Å—å —Å —Ç–µ–º, —á–µ–≥–æ –±–æ–∏—Ç–µ—Å—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ...",
    "–ü—É—Å—Ç—å –∫–æ—à–º–∞—Ä—ã —Å—Ç–∞–Ω—É—Ç –≤–∞—à–µ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é —Å–µ–≥–æ–¥–Ω—è!",
    "–°–µ–≥–æ–¥–Ω—è –≤—ã –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ, –∫–∞–∫ —Å—Ç—Ä–∞—Ö –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ –≤–∞—à—É –¥—É—à—É..."
]
threatening_phrases = [
    "–í—ã —Ä–∞–∑–±—É–¥–∏–ª–∏ –¥—Ä–µ–≤–Ω–µ–µ –∑–ª–æ...",
    "–¢—å–º–∞ —É–∂–µ –∑–¥–µ—Å—å... –∏ –æ–Ω–∞ –≥–æ–ª–æ–¥–Ω–∞...",
    "–í–∞—à–∏ –¥—É—à–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –º–Ω–µ!",
    "–°–∫–æ—Ä–æ –≤—ã —É–∑–Ω–∞–µ—Ç–µ, —á—Ç–æ —Ç–∞–∫–æ–µ –Ω–∞—Å—Ç–æ—è—â–∏–π —É–∂–∞—Å...",
    "–ù–∏–∫—Ç–æ –∏–∑ –≤–∞—Å –Ω–µ —Å–ø–∞—Å–µ—Ç—Å—è..."
]

# –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–∑—Ä–∞–∫–∞
ghost_story = "–Ø –±—ã–ª –∫–æ–≥–¥–∞-—Ç–æ —á–µ–ª–æ–≤–µ–∫–æ–º, –Ω–æ —Ç—Ä–∞–≥–∏—á–µ—Å–∫–∞—è —Å–º–µ—Ä—Ç—å –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∞ –º–µ–Ω—è –≤ –ø—Ä–∏–∑—Ä–∞–∫–∞. –¢–µ–ø–µ—Ä—å —è –±–ª—É–∂–¥–∞—é –≤ –ø–æ–∏—Å–∫–∞—Ö –ø–æ–∫–æ—è..."

# –û—á–µ—Ä–µ–¥—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
message_times = deque(maxlen=6)  # –•—Ä–∞–Ω–∏–º –¥–æ 6 —Å–æ–æ–±—â–µ–Ω–∏–π (5 + 1 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
def add_red_pill_user(user_id):
    cursor.execute('INSERT OR IGNORE INTO red_pill_users (user_id) VALUES (?)', (user_id,))
    conn.commit()

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—ã–±—Ä–∞–≤—à–∏—Ö "–ö—Ä–∞—Å–Ω—É—é —Ç–∞–±–ª–µ—Ç–∫—É"
def get_red_pill_users():
    cursor.execute('SELECT user_id FROM red_pill_users')
    return [row[0] for row in cursor.fetchall()]

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—É–≥–∞—é—â–∏—Ö —Ñ—Ä–∞–∑
def send_scary_phrase():
    while True:
        time.sleep(7200)  # 2 —á–∞—Å–∞
        bot.send_message(CHAT_ID, random.choice(scary_phrases))

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —á–∞—Ç–µ
def check_chat_activity():
    last_message_time = datetime.now()
    while True:
        time.sleep(300)  # 5 –º–∏–Ω—É—Ç
        if (datetime.now() - last_message_time) > timedelta(hours=5):
            bot.send_message(CHAT_ID, random.choice(empty_chat_phrases))
        last_message_time = datetime.now()

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∂–µ–ª–∞–Ω–∏—è
def send_morning_wish():
    wish = random.choice(morning_wishes)
    bot.send_message(CHAT_ID, f"üåë –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! {wish}")

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º —Ç–∞–±–ª–µ—Ç–∫–∏
def send_pill_message():
    keyboard = InlineKeyboardMarkup()
    red_pill = InlineKeyboardButton(text="–ö—Ä–∞—Å–Ω–∞—è —Ç–∞–±–ª–µ—Ç–∫–∞", callback_data="red_pill")
    blue_pill = InlineKeyboardButton(text="–°–∏–Ω—è—è —Ç–∞–±–ª–µ—Ç–∫–∞", callback_data="blue_pill")
    keyboard.add(red_pill, blue_pill)
    bot.send_message(CHAT_ID, "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –ø—É–≥–∞–ª —Ç–µ–±—è –ª–∏—á–Ω–æ - –±–µ—Ä–∏ –∫—Ä–∞—Å–Ω—É—é —Ç–∞–±–ª–µ—Ç–∫—É, –∞ –µ—Å–ª–∏ –Ω–µ—Ç - –æ—Å—Ç–∞–≤–∞–π—Å—è –ø—Ä–∏ —Å–∏–Ω–µ–π.", reply_markup=keyboard)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∞–±–ª–µ—Ç–∫–æ–π
def schedule_tasks():
    moscow_tz = pytz.timezone('Europe/Moscow')
    schedule.every().day.at("09:00").do(send_morning_wish).timezone = moscow_tz
    schedule.every().day.at("12:00").do(send_pill_message).timezone = moscow_tz  # –ü—Ä–∏–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å
    while True:
        schedule.run_pending()
        time.sleep(1)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
def check_message_flood():
    global message_times
    while True:
        time.sleep(1)
        if len(message_times) >= 5:  # –ï—Å–ª–∏ –±–æ–ª—å—à–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥
            if (datetime.now() - message_times[0]) <= timedelta(seconds=10):
                msg = bot.send_message(CHAT_ID, random.choice(threatening_phrases))
                threading.Timer(4, bot.delete_message, args=[CHAT_ID, msg.message_id]).start()  # –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
                message_times.clear()  # –û—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≥—Ä–æ–∑—ã

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: '–ø—Ä–∏–∑—Ä–∞–∫' in message.text.lower())
def respond_to_ghost(message):
    msg = bot.reply_to(message, random.choice(ghost_responses))
    threading.Timer(4, bot.delete_message, args=[message.chat.id, msg.message_id]).start()  # –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã

@bot.message_handler(func=lambda message: '–¥—É—Ö' in message.text.lower())
def respond_to_spirit(message):
    msg = bot.reply_to(message, spirit_response)
    threading.Timer(4, bot.delete_message, args=[message.chat.id, msg.message_id]).start()  # –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã

@bot.message_handler(func=lambda message: '–∫–æ—Å—Ç–∏' in message.text.lower())
def respond_to_bones(message):
    msg = bot.reply_to(message, bones_response)
    threading.Timer(4, bot.delete_message, args=[message.chat.id, msg.message_id]).start()  # –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã

@bot.message_handler(func=lambda message: '—Å—Ç—Ä–∞—Ö' in message.text.lower())
def respond_to_fear(message):
    msg = bot.reply_to(message, fear_response)
    threading.Timer(4, bot.delete_message, args=[message.chat.id, msg.message_id]).start()  # –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã

@bot.message_handler(commands=['–Ω–∞–ø—É–≥–∞—Ç—å_–≤—Å–µ—Ö'])
def scare_everyone(message):
    bot.send_message(CHAT_ID, "–í–°–ï –ë–£–î–£–¢ –ü–†–û–ö–õ–Ø–¢–´!")

@bot.message_handler(commands=['–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ'])
def send_message_as_bot(message):
    if message.from_user.id in ADMIN_IDS:
        try:
            msg = message.text.split(' ', 1)[1]
            bot.send_message(CHAT_ID, msg)
        except IndexError:
            bot.reply_to(message, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /–æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Å–æ–æ–±—â–µ–Ω–∏–µ.")
    else:
        bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")

@bot.message_handler(commands=['–∏—Å—Ç–æ—Ä–∏—è_–ø—Ä–∏–∑—Ä–∞–∫–∞'])
def tell_ghost_story(message):
    bot.reply_to(message, ghost_story)

# –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∞
@bot.message_handler(commands=['1'])
def admin_command_1(message):
    if message.from_user.id in ADMIN_IDS:
        bot.send_message(CHAT_ID, "–°—Ç—Ä–∞—à–Ω–æ? –û–±–æ—Å—Ä–∞–ª–∏—Å—å?")
    else:
        bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")

@bot.message_handler(content_types=['photo'])
def handle_photo(message):
    file_id = message.photo[-1].file_id  # –ü–æ–ª—É—á–∞–µ–º file_id –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ (—Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ) —Ñ–æ—Ç–æ
    bot.reply_to(message, f"File ID: {file_id}")

@bot.message_handler(commands=['2'])
def admin_command_2(message):
    if message.from_user.id in ADMIN_IDS:
        try:
            # –†–∞–∑–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ file_id –∏ —Ç–µ–∫—Å—Ç
            parts = message.text.split(' ', 2)  # –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ 3 —á–∞—Å—Ç–∏: –∫–æ–º–∞–Ω–¥–∞, file_id, —Ç–µ–∫—Å—Ç
            if len(parts) < 3:
                bot.reply_to(message, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ file_id –∏ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /2.")
                return
            
            file_id = parts[1]  # file_id –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
            text = parts[2]     # –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ ‚Äî —ç—Ç–æ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º
            bot.send_photo(CHAT_ID, file_id, caption=text)
        except Exception as e:
            bot.reply_to(message, f"–û—à–∏–±–∫–∞: {e}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã.")
    else:
        bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")
        
@bot.message_handler(commands=['3'])
def admin_command_3(message):
    if message.from_user.id in ADMIN_IDS:
        try:
            msg = message.text.split(' ', 1)[1]
            for user_id in get_red_pill_users():
                bot.send_message(user_id, msg)
        except IndexError:
            bot.reply_to(message, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /3.")
    else:
        bot.reply_to(message, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã.")

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ inline-–∫–Ω–æ–ø–æ–∫
@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call):
    if call.data == "red_pill":
        add_red_pill_user(call.from_user.id)
        bot.answer_callback_query(call.id, "–¢—ã –≤—ã–±—Ä–∞–ª –∫—Ä–∞—Å–Ω—É—é —Ç–∞–±–ª–µ—Ç–∫—É. –¢–µ–ø–µ—Ä—å —è –±—É–¥—É –ø—É–≥–∞—Ç—å —Ç–µ–±—è –ª–∏—á–Ω–æ!")
        bot.send_message(call.from_user.id, "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ª–∏—á–Ω—ã–π —á–∞—Ç. –¢–µ–ø–µ—Ä—å —è –±—É–¥—É –ø—É–≥–∞—Ç—å —Ç–µ–±—è!")
    elif call.data == "blue_pill":
        bot.answer_callback_query(call.id, "–¢—ã –≤—ã–±—Ä–∞–ª —Å–∏–Ω—é—é —Ç–∞–±–ª–µ—Ç–∫—É. –°–æ–æ–±—â–µ–Ω–∏–µ –∏—Å—á–µ–∑–Ω–µ—Ç.")
        bot.delete_message(call.message.chat.id, call.message.message_id)

# –û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –∫–æ–º–∞–Ω–¥—ã)
@bot.message_handler(func=lambda message: True)
def track_messages(message):
    global message_times
    if message.chat.id == CHAT_ID:
        # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "/"
        if not message.text.startswith('/'):
            message_times.append(datetime.now())  # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
if __name__ == '__main__':
    threading.Thread(target=send_scary_phrase).start()
    threading.Thread(target=check_chat_activity).start()
    threading.Thread(target=schedule_tasks).start()
    threading.Thread(target=check_message_flood).start()
    bot.polling(none_stop=True)
